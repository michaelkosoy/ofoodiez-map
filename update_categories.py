import pandas as pd
import re

raw_text = """
WEEKENDS

שישי

LP עד 20:00 קוקטיילים ב35₪, 20% על האוכל

בר 223 עד 20:00 20% על האלכוהול

רופטופ 98 30% על הכל עד השעה 20:00

פנטסטיק עד 20:00 30% על הכל

תל אה וין בצהריים 1+1 על האלכוהול

נואמה עד 19:00 20% על הכל

לואי עד 19:00 1+1 על האוכל, 20% על האלכוהול

שבת

בר 223 עד 20:00 20% על הכל

LP עד 20:00 קוקטיילים ב35₪, 20% על האוכל 

רופטופ 98 30% על הכל

ליברה עד 20:00 30% על הכל

קונסיירז עד 20:00 25% על האוכל, דרינקים מוזלים

שאטו שועל עד 19:30 50% על האלכוהול,1+1 אוכל

שה ויוי עד 19:30 30% על האלכוהול,20% האוכל

אליבי עד 19:30 20% על הכל

פנטסטיק עד 20:00 30% על הכל

קיצוקאי עד 19:30 1+1 על האלכוהול

אל וסינו עד 19:15 1+1 על כוסות ומנות נבחרות

לני עד 19:00 1+1 על האוכל, 20% על השתייה

מאדאם עד 19:00 30% על הכל

נואמה עד 19:00 20% על הכל

מי וה עד 19:30 25% על האלכוהול

לואי עד 19:00 1+1 על האוכל, 20% על האלכוהול

תל אה וין בצהריים 1+1 על האלכוהול

After 20:00

עד 20:30

ג’ניה 30% על הכל

רובינא 30% על הכל


עד 21:00

בLUCIE כל הקוקטיילים 1+1 

דנים בר 1+1 על האלכוהול 

ג׳וניפר 40% על הכל

עד 22:00

בית גולדברג 40% על כל המשאות כל הערב(חוץ מחמישי ושישי)

גרקו מנות ודרינקים עד 58 שח

SKY RIDERS כל המשקאות ב30₪

טימוטי קפה כוסות יין עד 20₪, בקבוקי יין עד 85₪

Until 20:00

מרכז העיר+צפון ישן

רופטופ 98 30% על הכל

פנטסטיק 30% על הכל

בר זוהר 1+1 על האלכוהול, 20% על האוכל

בית גולדברג 40% על האלכוהול(כל הערב, לא כולל חמישי שישי), 30% על האוכל עד 20

קפה מאייר 30% על הכל

מוזמביק 30% על הכל

יאסו 30% על הכל

ראמה 30% על הכל 

טרב 30% על הכל

צינה 30 על הכל

גרגר הזהב דיזינגוף 30% על הכל 

קפה 88 50% על האלכוהול, 25% על האוכל

קונסיירג 25% על האוכל, 50% על השתייה

בושוויק 25% על כל התפריט

סאצ’י סושי 25% על כל התפריט

שולי לוצי 25% על הכל

נואמה 20% על הכל 

לולו 47 20% על הכל

בר 223 20% על הכל

בל בוי 50% על האלכוהול

דרום העיר

הוטל סיסיל 1+1 על הכל

המשביר 2 30% על הכל

דוט 20% על הכל

Jazzkissa יש 30% על הכל

שאפה בר 30% על הכל

פארוק בשוק 50% על האלכוהול,20% על התפריט

7to1lab כל הקוקטיילים ב34

זולא נמל יפו 25% על הכל

until 19:30

פלאזה קפה 50% על האלכוהול, 25% על האוכל

קפה פופולר 30% על הכל

רובע בר יין 50% על האלכוהול, 20% על האוכל 

תל אה וין 50% על האלכוהול, 20% על האוכל

שאטו שועל 50% על האלכוהול, 1+1 על האוכל

צפון אברקסס 30% על הכל 

רנה 30% על הכל

שז ויוי 30% על האלכוהול, 20% על האוכל

נורדר 30% על הכל או תפריט מוזל

וודו אוכל עד 40₪,קוקטיילים 35₪,יין ובירה 25₪ 

ליברה 30% על הכל

קיצוקאי 1+1 על האלכוהול

סלאס 20% על ארוחת טעימות, 1+1 על האלכוהול

אליבי 20% על הכל

רומנו 20% על הכל

הגפן 20% על הכל

כריסטוף סלון יין 20% על הכל 

על הבר 25% על הכל

מי וה 25% על האלכוהול

Until 19:00

לני 1+1 על האוכל, 20% על האלכוהול

קפה אירופה 30% על הכל

ורמוטריה 30% על הכל

בר ורמיני 30% על הכל

מרלן 15% על הכל עד 19, 1+1 על המבורגרים כל הערב בראשון-רביעי

ציקטי 30% על הכל

גאזטה 30% על הכל

קפה נואר כוסות אלכוהול נבחר עד 38 שח

הרצל 16 30% על האוכל, יין וקוטיילים במחירים מוזלים

TYO יש 25% על כל התפריט

קפה 38 25% על הכל

קפה קוקו 25% על הכל  

לואי 20% על השתייה, 1+1 על האוכל

בבר הכרמל 1+1 על האלכוהול

יין בחצר 30% על הכל

ביינא 30% על האלכוהול, 15% על האוכל

AKA יש 20% על הכל

קאב קם 20% על הכל

קיוסק דל פסטה 20% על הכל

התאילנדית בסמטת סיני 20% על הכל

יעקב בנחלה 20% על הכל

בראבה גנטה 20% על הכל

גוצ׳ה 20% על הכל

קופ נטור 20% על הכל 

וינונה פוראבר 20% על אוכל ויין

טייסטינג רום שרונה 20% על האוכל, כוסות יין מתחת ל30₪

מלגו ומילבר 20% על האוכל, 1+1 על האלכוהול

מנרה 25% על הכל

קונטנטו 1+1 על האלכוהול

בר פרדיסו מנות ושפריצים ב32₪

מרכז העיר המשך:

אוקינאווה סושי 20% על הכל, ו3 ביסים בהזמנת כוס יין מתנה

מרולזה 20% על הכל

המבורגר הסמטה 20% על הכל

מיני בר מרמורק 20% על הכל 

בסטה 20% על האלכוהול

ווינברי לילנבלום 1+1 על הכוסות יין

הנסיך 30% על הכל

אולה אולה 15% על האוכל,1+1 על האלכוהול

יאן סושי בר 25% על האלכוהול

הכוסית 20% על הכל

ברבור 20% על הכל

מקווה בר יין 20% על הכוסות והבקבוקי יין

כפרה מיו(עד 18:30) 25% על הכל

מגזינו (עד 18:30) 25% על הכל

טברנה רומנה 40% על הכל בין השעות 17-18

צפון ישן:

תריסר 20% על הקוקטיילים, מספר מנות מוזלות

בנדיקט R&D יש 50% על האלכוהול ועל הויטרינה

פסטלה 50% על האלכוהול, 20% על האוכל 

דרום העיר-פלרונטין ויפו:

לונל 30% על הכל

מוניקה לוינסקי 30% על הכל

ג׳ורג וגון 25% על הכל

פר דרייר 50% על האוכל, 20% על האלכוהול

בית קנדידוף 25% על הכל

מסקל 25% על הכל

אוקינאווה 20% על הכל

קנטינה סן רמו כוסות יין ב30₪

לה טיגרה פלטת דילקטסים בקניית 2 דרינקים

Zetz יש 1+1 על האלכוהול, 20% על האוכל 

מיראז׳ 1+1 על הקוקטיילים

בקאפיקו 1+1 על הראשונות,20% על האלכוהול

אנטיליה 30% על כל הפסטות(עד 18:30)

קיו 20% על הכל בין השעות 17-18
"""

def parse_categories(text):
    lines = text.strip().split('\n')
    place_categories = {}
    current_time_category = "WEEKENDS" # Default start based on new text
    
    for line in lines:
        line = line.strip()
        if not line:
            continue
            
        # Detect time categories
        lower_line = line.lower()
        
        # Explicit English headers
        if lower_line.startswith("until") or lower_line.startswith("after") or lower_line.startswith("weekends") or lower_line.startswith("not tlv"):
            # Only remove trailing colon if present
            clean_cat = line.strip()
            if clean_cat.endswith(':'):
                clean_cat = clean_cat[:-1]
            current_time_category = clean_cat
            
            # Normalize "not tlv"
            if "not tlv" in lower_line:
                current_time_category = "Not TLV"
            continue
            
        # Skip Hebrew location headers if they don't contain time info
        if re.search(r'[\u0590-\u05FF]', line) and line.endswith(':'):
             continue

        # Skip comments like "these..."
        if lower_line.startswith("these"):
            continue

        # Extract Name
        match = re.search(r'\d', line)
        if match:
            idx = match.start()
            split_idx = line.rfind(' ', 0, idx)
            if split_idx != -1:
                name = line[:split_idx].strip()
            else:
                name = line[:idx].strip()
        else:
            parts = line.split(' ', 2)
            if len(parts) > 1:
                name = " ".join(parts[:2])
            else:
                name = line
        
        place_categories[name] = current_time_category
        
    return place_categories

# Update Excel
try:
    df = pd.read_excel('places.xlsx')
    df = df.fillna("")
    
    categories_map = parse_categories(raw_text)
    updated_count = 0
    
    for index, row in df.iterrows():
        name = row.get('Name')
        if name in categories_map:
            df.at[index, 'Category'] = categories_map[name]
            updated_count += 1
            
    df.to_excel('places.xlsx', index=False)
    print(f"Updated categories for {updated_count} places.")
    
except Exception as e:
    print(f"Error: {e}")
